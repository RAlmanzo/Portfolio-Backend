ARG DOTNET_VERSION=8.0

# ğŸ› ï¸ Build Stage
FROM mcr.microsoft.com/dotnet/sdk:${DOTNET_VERSION} AS build
WORKDIR /src

ARG BUILD_CONFIGURATION=Release

# ğŸ“¦ Projectbestanden kopiÃ«ren
COPY ["Portfolio.Api/Portfolio.Api.csproj", "Portfolio.Api/"]
COPY ["Portfolio.Core/Portfolio.Core.csproj", "Portfolio.Core/"]
COPY ["Portfolio.Infrastructure/Portfolio.Infrastructure.csproj", "Portfolio.Infrastructure/"]

# ğŸ”„ Dependencies restoren (gebruikt caching optimaal)
RUN dotnet restore "Portfolio.Api/Portfolio.Api.csproj"

# ğŸ“ Alles kopiÃ«ren voor build
COPY . .
WORKDIR "/src/Portfolio.Api"

# ğŸ—ï¸ Build en publish
RUN dotnet publish "Portfolio.Api.csproj" -c $BUILD_CONFIGURATION -o /app/publish

# ğŸš€ Runtime Stage
FROM mcr.microsoft.com/dotnet/aspnet:${DOTNET_VERSION} AS final
WORKDIR /app

# ğŸ“¤ Publicatie uit build-stage kopiÃ«ren
COPY --from=build /app/publish .

# ğŸŒ Expose poort
EXPOSE 8080

# ğŸƒâ€â™‚ï¸ Start de app
ENTRYPOINT ["dotnet", "Portfolio.Api.dll"]